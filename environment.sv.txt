class environment;
  generator gen;
  driver drv;
  monitor mon;
  scoreboard scb;

  mailbox #(transaction) gen2drv;
  mailbox #(transaction) mon2scb;
  virtual spi_if vif;

  function new(virtual spi_if vif);
    this.vif = vif;

    // Initialize mailboxes
    gen2drv = new();
    mon2scb = new();

    // Instantiate components
    gen = new(gen2drv);
    drv = new(vif, gen2drv);
    mon = new(vif, mon2scb);
    scb = new(mon2scb);
  endfunction

  task reset();
    drv.reset();  
  endtask

  task run();
    fork
      gen.run(); 
      drv.run();  
      mon.run();  
      scb.run();  
    join_none
  endtask
endclass
